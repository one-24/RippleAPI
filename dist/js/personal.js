"use strict";$(function(){"En"==window.localStorage.getItem("lang")?($("[data-localize]").localize("/json/lang",{language:"en"}),$("#RB-header-language a").eq(0).text("English"),$("#RB-header-language span").text("简体中文")):($("[data-localize]").localize("/json/lang",{language:"ch"}),$("#RB-header-language a").eq(0).text("简体中文"),$("#RB-header-language span").text("English"));var i="http://118.190.201.235:8092",l=window.localStorage.getItem("tok"),n=JSON.parse(window.localStorage.getItem("user")),r=!0,a="WalletApi";function o(e,a){var t=CryptoJS.enc.Utf8.parse(a);return CryptoJS.DES.encrypt(e,t,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString()}function e(e){e.addClass("is-active"),$(".rightFixEmail").val(n.name),e.on("click",".rightFixSendMsg",function(){console.log("object");var e=60,a=setInterval(function(){e--,$(".sendTime span").text(e),e<=0&&clearInterval(a)},1e3);$.ajax({url:i+"/user/sendMailCode",type:"post",data:{mail:n.name}})})}function t(){$(".modal").removeClass("is-active")}function t(){$(".modal").removeClass("is-active")}$.ajax({url:i+"/user/getUserInfo",type:"post",headers:{token:l},success:function(e){if("200"==e.msgCode&&"SUCCESS"==e.result){"1"==e.data.status?(r=!1,$(".ApplyKeyBtn").val("申请KEY(审核中)"),$(".ApplyKeyBtn").css("display","block"),$(".ApplyKeyBtn").css("cursor","help"),$(".ApplyKeyBtn").attr("disabled","disabled")):"2"==e.data.status?(r=!1,$(".inputKey").val(e.data.key),$(".ApplyKeyBtn").attr("disabled","disabled"),$(".ApplyKeyBtn").css("display","none")):"3"==e.data.status&&(r=!0,$(".ApplyKeyBtn").val("申请KEY"),$(".ApplyKeyBtn").css("display","block"));var a=e.data,t=a.comeAddress,s=a.loginName,o=(a.registerTime,a.toAddress);$(".right-personalInfo .personalEmailNumber").val(s),$(".right-personalInfo .personalPassword").val(n.pass),$(".right-personalInfo .comeaddress").val(t),$(".right-personalInfo .toaddress").val(o)}}}),$(".right-personalInfo").on("click",".changePassWord",function(){var s=$(".modal-changePassWord");e(s),$(".btnSureChangePassword").on("click",function(){var t=o($(".rightFixNewPassword").val(),a),e=o($(".rightFixSureNewPassword").val(),a);$.ajax({url:i+"/user/updatePsw",type:"post",headers:{token:l},data:{mail:n.name,code:$(".modal-changePassWord .rightFixCode").val(),psw:t,confirmPsw:e},success:function(e){if("200"==e.msgCode&&"SUCCESS"==e.result){var a={name:n.name,pass:t};window.localStorage.setItem("user",JSON.stringify(a)),s.removeClass("is-active")}}})})}),$(".right-personalInfo").on("click",".changeComeaddress",function(){var t=$(".modal-changeComeAddress");e(t),$(".btnSureChangeComeAddress").on("click",function(){var a=$(".rightFixNewComeAddress").val();$.ajax({url:i+"/user/updateComeAddress",type:"post",headers:{token:l},data:{mail:n.name,code:$(".modal-changeComeAddress .rightFixCode").val(),comeAddress:a},success:function(e){"200"==e.msgCode&&"SUCCESS"==e.result&&($(".comeaddress").val(a),t.removeClass("is-active"))}})})}),$(".right-personalInfo").on("click",".changeToAddress",function(){var t=$(".modal-changeToAddress");e(t),$(".btnSureChangeToAddress").on("click",function(){var a=$(".rightFixNewToAddress").val();$.ajax({url:i+"/user/updateToAddress",type:"post",headers:{token:l},data:{mail:n.name,code:$(".modal-changeToAddress .rightFixCode").val(),toAddress:a},success:function(e){"200"==e.msgCode&&"SUCCESS"==e.result&&($(".toaddress").val(a),t.removeClass("is-active"))}})})}),$(".modal-close").click(t),$(".modal-background").click(t),$(".btn-sure").click(t),$(".btn-cancel").click(t);var s=0;function d(){var e,a,t,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10,n=$(".method").val();e="打款"==n?1:"收款"==n?2:-1,a=$(".inputStime").val()||"2018-10-29",t=$(".inputEtime").val()||"2018-10-29",$.ajax({url:i+"/transfer/logs",type:"post",headers:{token:l},data:{type:e,sTime:a,eTime:t,pageNo:s,pageSize:o},success:function(e){if("200"==e.msgCode&&"SUCCESS"==e.result){var a=template("recordList",{recordDataList:e.data.transLogs});$("#record-table-tbody").html(a);for(var t=e.data.page,s=(t.pageNo,t.pageSize,t.totalNum,t.totalPage),o="",n=1;n<=s;n++)o+='<li class="fl"><a href="#">'+n+"</a></li>";o+='<li class="fl"><a href="#" class="lastPage" data-localize="PersonMainLastPage">最后一页</a></li>\n                                <li class="fl" data-localize="PersonMainJumpTo">跳转到 : <input type="text" class="text boxs orderPage"> <span data-localize="PersonMainPage">页</span></li>',$(".pagination").html(o)}}})}$(".toggleKey").click(function(){$(".inputKey").val()?"显示"==$(this).text()&&0==s?(s++,$(".Confirmation").addClass("is-active"),$(".displayKey input").attr("type","text"),$(this).text("隐藏")):($(".displayKey input").attr("type","password"),$(this).text("显示")):alert("请先申请key")});var c,p=/((^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(10|12|0?[13578])([-\/\._])(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(11|0?[469])([-\/\._])(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(0?2)([-\/\._])(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([3579][26]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][13579][26])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][13579][26])([-\/\._])(0?2)([-\/\._])(29)$))/;$(".inputStime").on("keypress",function(){var e=$(this).val();p.test(e)&&d()}),$(".inputEtime").on("keypress",function(){var e=$(this).val();p.test(e)&&d()}),c=$(".menu li").slice(1,3),$(c).click(function(){$(this).addClass("active"),$(this).siblings().removeClass("active");var e=$(this).index();1==e&&($($(".tab1")[0]).removeClass("tab").addClass("tabActive"),$($(".tab1")[1]).removeClass("tabActive").addClass("tab")),2==e&&($($(".tab1")[1]).removeClass("tab").addClass("tabActive"),$($(".tab1")[0]).removeClass("tabActive").addClass("tab"),d())}),$(".pagination").on("click","li",function(){var e=$(this).children("a").text();Number(e)&&d(e)}),$(".pagination").on("click",".lastPage",function(){d($(this).parent().prev().children("a").text())}),$(".pagination").on("keypress",".orderPage",function(e){if(13==e.keyCode){var a=$(this).val();parseInt(a)&&a<=$(".pagination li").length-2&&d(a)}});var u="";$(".sanjiao").click(function(){u=$(".method").val();var e=$(".oneMethod");"none"!=e.css("display")?e.css("display","none"):e.css("display","block")}),$(".oneMethod").click(function(){$(".oneMethod").css("display","none"),u!=$(this).text()&&($(".method").val($(this).text()),d())}),$(".ApplyKeyBtn").click(function(){var e=$(".comeaddress").val(),a=$(".toaddress").val();r&&(e&&a?$.ajax({headers:{token:l},type:"post",url:i+"/user/setApplyKey",data:{mail:n.name,psw:n.pass,toaddress:a,comeaddress:e,token:l},success:function(e){var a;"200"==e.msgCode&&"SUCCESS"==e.result?(a=window.localStorage.getItem("tok"),$.ajax({type:"post",headers:{token:a},url:i+"/getKey",data:{token:a},success:function(e){$(".inputKey").val(e.data),$(".ApplyKeyBtn").css("display","none")}})):"500"==e.msgCode&&"FAIL"==e.result?alert(e.msgContent):alert("获取失败 请稍后再试")}}):alert("请输入正确的收 / 打款地址"))}),$(".btnExport1").on("click",function(){var e=$(".inputStime").val()||"2018-10-29",a=$(".inputEtime").val()||"2018-10-29";!function(e){var a=$.extend(!0,{method:"post"},e),t=$('<iframe id="down-file-iframe" />'),s=$('<form target="down-file-iframe" method="'+a.method+'" />');for(var o in s.attr("action",a.url),a.data)s.append('<input type="hidden" name="'+o+'" value="'+a.data[o]+'" />');t.append(s),$(document.body).append(t),s[0].submit(),t.remove()}({url:i+"/transfer/exportLogsByTime",data:{sTime:e,eTime:a}})}),$(".btnExport2").on("click",function(){$(".inputStime").val(),$(".inputEtime").val(),$.ajax({url:i+"/transfer/exportLogs",headers:{token:l}})}),$(".exitLogon").on("click",function(){$.ajax({url:i+"/layout",headers:{token:l},success:function(){var e=window;e.localStorage.removeItem("user"),e.localStorage.removeItem("tok"),e.location.href="/index.html"}})})});